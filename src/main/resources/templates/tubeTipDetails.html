<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Video details</title>
    </head>

    <body>
        <button id="back-button" onclick="back()">Back</button>
        <h1>Video tip details</h1>

        <ul th:each="error : ${errors}">
            <li th:text="${error}">here</li>
        </ul>

        <iframe name="hiddenframe" style="display: none;"></iframe>
        <b>Studied:</b>
        <form style="display: inline-block"  id="studied" method="POST" th:action="@{/tube_tip/{id}/study(id=${tube.id})}" target="hiddenframe">
            <input th:if="${not tube.studied}" id="studiedcheck" type="checkbox" name="studied" value="1" onchange="this.form.submit()"/>
            <input th:if="${tube.studied}" id="studiedcheck" type="checkbox" name="studied" value="1" onchange="this.form.submit()" checked="checked"/>
            <input id="studiedHidden" type="hidden" value="0" name="studied"/>
        </form>

        <div id="tube-tip-details"></div>
        <div id="buttons">
        </div>

        <script th:inline="javascript">

            function back() {
                window.location.href = "/";
            }

            /*<![CDATA[*/
            var tube = /*[[${tube}]]*/ 'tube';
            /*]]>*/

            function addDeleteButton() {
                var deleteButton = document.createElement("button");
                deleteButton.id = "delete-button";
                deleteButton.innerHTML = "Delete"
                        + "<form name='deleteForm' method='POST' action='/tube_tip/[[${tube.id}]]'>"
                        + "<input type='hidden' name='_method' value='DELETE'>"
                        + "<\/form>";
                deleteButton.onclick = deleteTube
                document.getElementById("buttons").appendChild(deleteButton);
            }

            function removeDeleteButton() {
                var deleteButton = document.getElementById("delete-button");
                if (deleteButton) {
                    deleteButton.parentNode.removeChild(deleteButton);
                }
            }

            function addEditButton() {
                var editButton = document.createElement("button");
                editButton.id = "edit-button";
                editButton.innerHTML = "Edit"
                editButton.onclick = editEnabled
                document.getElementById("buttons").appendChild(editButton);
            }

            function removeEditButton() {
                var editButton = document.getElementById("edit-button");
                if (editButton) {
                    editButton.parentNode.removeChild(editButton);
                }
            }

            function addSaveButton() {
                var saveButton = document.createElement("button");
                saveButton.id = "save-button";
                saveButton.innerHTML = "Save"
                saveButton.onclick = saveTube
                document.getElementById("buttons").appendChild(saveButton);
            }

            function removeSaveButton() {
                var saveButton = document.getElementById("save-button");
                if (saveButton) {
                    saveButton.parentNode.removeChild(saveButton);
                }
            }

            function addCancelButton() {
                var cancelButton = document.createElement("button");
                cancelButton.id = "cancel-button";
                cancelButton.innerHTML = "Cancel"
                cancelButton.onclick = editDisabled
                document.getElementById("buttons").appendChild(cancelButton);
            }

            function removeCancelButton() {
                var cancelButton = document.getElementById("cancel-button");
                if (cancelButton) {
                    cancelButton.parentNode.removeChild(cancelButton);
                }
            }

            function editDisabled() {
                emptyElements();
                document.getElementById("tube-tip-details").innerHTML =
                        "Author: " + tube.author + "<br/>"
                        + "Title: " + tube.title + "<br/>"
                        + "URL: <a href='" + tube.url + "'>" + tube.url + "</a><br/>"
                        + "Tags: " + tube.tags + "<br/>"
                        + "<textarea rows='4' cols='50' readonly placeholder='Description'>" 
                        + tube.description + "</textarea></br>";
                addDeleteButton();
                addEditButton();
            }

            function editEnabled() {
                emptyElements();
                document.getElementById("tube-tip-details").innerHTML =
                        "<form id='editForm' name='editForm' method='POST' action='/tube_tip/[[${tube.id}]]'>"
                        + "(*)Author: <input name='author' value='" + tube.author + "'/><br/>"
                        + "(*)Title: <input name='title' value='" + tube.title + "'/><br/>"
                        + "(*)ISBN: <input name='url' value='" + tube.url + "'/><br/>"
                        + "(*)Tags: <input name='tags' value='" + tube.tags + "'/><br/>"
                        + "<textarea rows='4' cols='50' form=editForm name='description' wrap='hard' placeholder='Description'>" 
                        + tube.description + "</textarea></br>"
                        + "<input type='hidden' name='_method' value='PUT'>"
                        + "<\/form>";
                addSaveButton();
                addCancelButton();
            }

            function emptyElements() {
                document.getElementById("tube-tip-details").innerHTML = "";
                document.getElementById("buttons").innerHTML = "";
            }

            function deleteTube() {
                var confirmation = confirm("Do you really want to delete tube tip: "
                        + tube.title + " by " + tube.author + "?");
                if (confirmation) {
                    document.deleteForm.submit();
                }
            }

            function saveTube() {
                document.editForm.submit();
            }

            editDisabled();
        </script>
    </body>
</html>